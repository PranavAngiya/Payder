<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Stock </title> 
        <link rel="stylesheet" href="../../styles/lookup.css">
    </head>

    <body>

        <div class="navBar">

            <div class = "search_bar">
                <input type="text" id="searchBar" placeholder="Enter Stock Symbol or Name" />
                <button type="submit" id="searchButton">Search<i class="fa-search"></i></button>
            </div>

            <div id="listing">
                <ul>
                    <button id="homepage">Portfolio</button>
                    <button id="lookup">Stock Lookup</button>
                    <button id="settings">Account-Settings</button>
                    <button id="history">History</button>
                    <button id="logout">Sign-Out</button>
                    Hello: 
                    <span id="username">Unauthorized User</span>
                    Current Balance: 
                    <span id="balance">Error</span>
                </ul>
            </div>
            
        </div>

        <div class="container">
            <h1>Hello</h1>
            <h1>Hello</h1>
            <h1>Hello</h1>
            <h1>Hello</h1>
            <h1>Hello</h1>
        </div>
    
        <script type="module">
            import { getUsernameFromToken } from "../../scripts/utils/authCheck.js";
            import {apiRequest} from "../../scripts/api.js";

            async function displayUserData() {

                const username = getUsernameFromToken();
                if (username) {
                    document.getElementById("username").textContent = username;
                }

                const response = await apiRequest("/api/balance", "POST", { username });

                if (response.data.balance != null) { 
                    document.getElementById("balance").textContent = response.data.balance;
                } else {
                    document.getElementById("balance").textContent = "Error";
                }
            }

            // Display the username and balance
            document.addEventListener("DOMContentLoaded", displayUserData);

            async function searching() {

                const stockSymbol = document.getElementById("searchBar").value.trim().toUpperCase();

                if (stockSymbol) { 
                    // Make the container visible by adding the class
                    document.querySelector(".container").classList.add("visible");

                } else {
                    // Handle empty search (optional)
                    console.log("Please enter a stock symbol");
                }

            }

            // Display the username and balance
            document.getElementById("searchButton").addEventListener('click', searching)
    
            // Re-enter home page
            document.getElementById("homepage").addEventListener("click", function() {
                window.location.href = "userHome.html";
            });
    
            // Enter into settings
            document.getElementById("settings").addEventListener("click", function() {
                window.location.href = "/src/client/pages/settings/settings.html";
            });
    
            // Enter into settings
            document.getElementById("history").addEventListener("click", function() {
                window.location.href = "history.html";
            });
    
            // Logout function
            document.getElementById("logout").addEventListener("click", function() {
                localStorage.removeItem("authToken");
                window.location.href = "/src/client/pages/entry_pages/login.html";
            });
    
    
        </script>

    </body>

</html>